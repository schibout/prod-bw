<?xml version="1.0" encoding="UTF-8"?>
<Workflow xmlns="http://soap.sforce.com/2006/04/metadata">
    <fieldUpdates>
        <fullName>Decocher_Tech_Talend_Export_Devis</fullName>
        <field>Tech_Talend_Export_Devis__c</field>
        <literalValue>0</literalValue>
        <name>Decocher_Tech_Talend_Export_Devis</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Literal</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>MAJChampMontant</fullName>
        <field>DEV_Montant__c</field>
        <formula>TotalPrice</formula>
        <name>MAJChampMontant</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>MAJDateDExpiration</fullName>
        <field>ExpirationDate</field>
        <formula>ADDMONTHS( CreatedDate,2)</formula>
        <name>MAJDateD&apos;expiration</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>MAJDateDeRelance</fullName>
        <field>DEV_DateDeRelance__c</field>
        <formula>Today()+15</formula>
        <name>MAJDateDeRelance</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>MAJTalenHistorique</fullName>
        <field>Tech_TalendHistorique__c</field>
        <formula>LastModifiedBy.FirstName+&apos; &apos;+LastModifiedBy.LastName + &apos; ;&apos;+ PRIORVALUE(DEV_TypeDeDevis__c)+ &apos; ;&apos; + TEXT(DEV_TypeDeDevis__c)+ &apos; ;&apos;+  Opportunity.Account.RecordType.Name + &apos;;&apos; + TEXT(Status)+&apos; ;&apos;  +$User.FirstName + &apos; &apos; +  $User.LastName</formula>
        <name>MAJTalenHistorique</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>MAJ_ACCEPTED_BY</fullName>
        <field>DEV_Audit_Accepted_by__c</field>
        <formula>$User.LastName + &quot; &quot; +   $User.FirstName</formula>
        <name>MAJ_ACCEPTED_BY</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>MAJ_ACCEPTED_DATE</fullName>
        <field>DEV_Audit_Accepted_date__c</field>
        <formula>NOW()</formula>
        <name>MAJ_ACCEPTED_DATE</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>MAJ_Tech_QuoteNumber</fullName>
        <field>DEV_Tech_QuoteNumber_ExternalId__c</field>
        <formula>IF(AND($User.LastName !=$Label.API, OR(ISPICKVAL(DEV_TypeDeDevis__c,&apos;1&apos;), ISPICKVAL(DEV_TypeDeDevis__c,&apos;3&apos;))) , QuoteNumber , DEV_Tech_QuoteNumber_ExternalId__c )</formula>
        <name>MAJ_Tech_QuoteNumber</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>MAJ_Tech_QuoteNumberTEMPO</fullName>
        <field>DEV_Tech_QuoteNumber_ExternalId__c</field>
        <formula>IF(AND($User.LastName !=$Label.API, OR(ISPICKVAL(DEV_TypeDeDevis__c,&apos;1&apos;), ISPICKVAL(DEV_TypeDeDevis__c,&apos;3&apos;))) , QuoteNumber , DEV_Tech_QuoteNumber_ExternalId__c )</formula>
        <name>MAJ_Tech_QuoteNumberTEMPO</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>MAJ_Tech_Talend_Export_Devis</fullName>
        <description>Mettre MAJ_Tech_Talend_Export_Devis Vrai</description>
        <field>Tech_Talend_Export_Devis__c</field>
        <literalValue>1</literalValue>
        <name>MAJ_Tech_Talend_Export_Devis</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Literal</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>NomDuDevis</fullName>
        <field>Name</field>
        <formula>&quot;DEVISBW-0001&quot;</formula>
        <name>NomDuDevis</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>RenommerDevis</fullName>
        <field>Name</field>
        <formula>UPPER(&quot;QU-&quot;&amp;LEFT(Opportunity.Account.Name, 6)&amp;&quot;-&quot; &amp;Opportunity.TrigrammeSSDomaine__c&amp;&quot;-&quot;&amp;QuoteNumber)</formula>
        <name>RenommerDevis</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Renommer_Devis</fullName>
        <field>Name</field>
        <formula>UPPER(&quot;QU-&quot;&amp;LEFT(Opportunity.Account.Name, 6)&amp;&quot;-&quot; &amp;Opportunity.TrigrammeSSDomaine__c&amp;&quot;-&quot;&amp;QuoteNumber)</formula>
        <name>Renommer Devis</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Reprise_CPFacturation_Sur_CompteFacture</fullName>
        <field>BillingPostalCode</field>
        <formula>Opportunity.Account.BillingPostalCode</formula>
        <name>Reprise_CPFacturation_Sur_CompteFacture</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Reprise_PaysFacturation_Sur_CompteFactu</fullName>
        <field>BillingCountry</field>
        <formula>Opportunity.Account.BillingCountry</formula>
        <name>Reprise_PaysFacturation_Sur_CompteFactu</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Reprise_RegFacturation_Sur_CompteFactur</fullName>
        <field>BillingState</field>
        <formula>Opportunity.Account.BillingState</formula>
        <name>Reprise_RegFacturation_Sur_CompteFactur</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Reprise_RueFacturation_Sur_CompteFactur</fullName>
        <field>BillingStreet</field>
        <formula>Opportunity.Account.BillingStreet</formula>
        <name>Reprise_RueFacturation_Sur_CompteFactur</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Reprise_VilleFacturation_Sur_CompteFactu</fullName>
        <field>BillingCity</field>
        <formula>Opportunity.Account.BillingCity</formula>
        <name>Reprise_VilleFacturation_Sur_CompteFactu</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Formula</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <fieldUpdates>
        <fullName>Update_Type_Devis_pour_Composant</fullName>
        <field>DEV_TypeDeDevis__c</field>
        <literalValue>1</literalValue>
        <name>Update Type Devis pour Composant</name>
        <notifyAssignee>false</notifyAssignee>
        <operation>Literal</operation>
        <protected>false</protected>
        <reevaluateOnChange>false</reevaluateOnChange>
    </fieldUpdates>
    <rules>
        <fullName>WF100_QuoteAuditAccepted</fullName>
        <actions>
            <name>MAJ_ACCEPTED_BY</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>MAJ_ACCEPTED_DATE</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <criteriaItems>
            <field>Quote.Status</field>
            <operation>equals</operation>
            <value>3</value>
        </criteriaItems>
        <criteriaItems>
            <field>User.Alias</field>
            <operation>notEqual</operation>
            <value>api</value>
        </criteriaItems>
        <criteriaItems>
            <field>User.USER_ByPassRegleValidation__c</field>
            <operation>equals</operation>
            <value>False</value>
        </criteriaItems>
        <description>Renseigner les champs Accepted by et Accepted Date lorsque le devis est accepté</description>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>WF11_DEV_CreationDuDevis</fullName>
        <actions>
            <name>MAJDateDExpiration</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>MAJDateDeRelance</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>MAJ_Tech_QuoteNumber</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>RenommerDevis</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Reprise_CPFacturation_Sur_CompteFacture</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Reprise_PaysFacturation_Sur_CompteFactu</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Reprise_RegFacturation_Sur_CompteFactur</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Reprise_RueFacturation_Sur_CompteFactur</name>
            <type>FieldUpdate</type>
        </actions>
        <actions>
            <name>Reprise_VilleFacturation_Sur_CompteFactu</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <criteriaItems>
            <field>User.USER_ByPassRegleWorkflow__c</field>
            <operation>equals</operation>
            <value>False</value>
        </criteriaItems>
        <description>A la création du devis les champs Nom et date d&apos;expiration sont automatiquement renseignés</description>
        <triggerType>onCreateOnly</triggerType>
    </rules>
    <rules>
        <fullName>WF11_DEV_ModificationDuDevis</fullName>
        <actions>
            <name>Renommer_Devis</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <criteriaItems>
            <field>User.USER_ByPassRegleWorkflow__c</field>
            <operation>equals</operation>
            <value>False</value>
        </criteriaItems>
        <description>A la modification du devis le champs Nom est automatiquement renseigné</description>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>WF13_Devis_MAJ_ChampTechTalendExport</fullName>
        <actions>
            <name>MAJ_Tech_Talend_Export_Devis</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Cocher Tech_Talend_Export_Devis__c si l&apos;état de la Devis est Accepté</description>
        <formula>AND( 
          $User.USER_ByPassRegleWorkflow__c = False
          , $User.LastName != $Label.API
          ,  OR(TEXT( $User.USER_EntiteBW__c  ) != $Label.BW_ITA
                   ,AND(TEXT( $User.USER_EntiteBW__c  ) = $Label.BW_ITA
                             ,DEV_NombreLignesDeDevis__c &gt; 0)
                   )
          , Opportunity.Account.RecordType.Name = &apos;Compte Actif&apos;
          , OR(ISPICKVAL(DEV_TypeDeDevis__c, &apos;1&apos;)
                 , ISPICKVAL(DEV_TypeDeDevis__c,&apos;3&apos;)
                 ) 
         , ISPICKVAL(Status, &apos;3&apos;)
         )</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>WF14_Devis_DecocherChampTech</fullName>
        <actions>
            <name>Decocher_Tech_Talend_Export_Devis</name>
            <type>FieldUpdate</type>
        </actions>
        <active>false</active>
        <criteriaItems>
            <field>Quote.Status</field>
            <operation>notEqual</operation>
            <value>3</value>
        </criteriaItems>
        <criteriaItems>
            <field>User.LastName</field>
            <operation>notEqual</operation>
            <value>API</value>
        </criteriaItems>
        <triggerType>onCreateOrTriggeringUpdate</triggerType>
    </rules>
    <rules>
        <fullName>WF15_DEV_RecopieChampStandardPrix</fullName>
        <actions>
            <name>MAJChampMontant</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <description>Permet de recopier le champ</description>
        <formula>AND ( $User.USER_ByPassRegleWorkflow__c = False, NOT(ISPICKVAL(DEV_TypeDeDevis__c,&apos;2&apos;)), $User.LastName != &apos;API&apos;, ISCHANGED(TotalPrice))</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>WF16_DEV_HistoriqueTechTalend</fullName>
        <actions>
            <name>MAJTalenHistorique</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <formula>AND($User.USER_ByPassRegleWorkflow__c = False,ISCHANGED( Status ),ISPICKVAL(Status ,&apos;3&apos;))</formula>
        <triggerType>onAllChanges</triggerType>
    </rules>
    <rules>
        <fullName>WF_Devis_Update Type Devis pour Composant</fullName>
        <actions>
            <name>Update_Type_Devis_pour_Composant</name>
            <type>FieldUpdate</type>
        </actions>
        <active>true</active>
        <criteriaItems>
            <field>Quote.DEV_TypeDeDevis__c</field>
            <operation>equals</operation>
        </criteriaItems>
        <criteriaItems>
            <field>User.USER_ByPassRegleWorkflow__c</field>
            <operation>equals</operation>
            <value>False</value>
        </criteriaItems>
        <triggerType>onCreateOnly</triggerType>
    </rules>
    <tasks>
        <fullName>RelanceDevis</fullName>
        <assignedToType>owner</assignedToType>
        <dueDateOffset>2</dueDateOffset>
        <notifyAssignee>false</notifyAssignee>
        <priority>Normal</priority>
        <protected>false</protected>
        <status>Ouvert</status>
        <subject>Relance Devis</subject>
    </tasks>
</Workflow>
